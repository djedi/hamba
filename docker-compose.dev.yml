# Docker Compose override for local development
# Usage: docker compose -f docker-compose.yml -f docker-compose.dev.yml up
#
# This configuration mounts source code for hot reload during development.
# For production, use only: docker compose up

services:
  backend:
    build:
      target: deps
    volumes:
      # Mount source code for hot reload
      - ./backend/src:/app/src:ro
      # Persist database in development
      - ./data:/app/data
    command: ["bun", "--hot", "run", "src/index.ts"]
    environment:
      - NODE_ENV=development
      - LOG_LEVEL=debug

  frontend:
    # For development, run the dev server instead of nginx
    build:
      context: ./frontend
      target: builder
    ports:
      - "8878:8878"
    volumes:
      # Mount source code for hot reload
      - ./frontend/src:/app/src:ro
      - ./frontend/static:/app/static:ro
    command: ["bun", "run", "dev", "--host", "0.0.0.0", "--port", "8878"]
    environment:
      - NODE_ENV=development
